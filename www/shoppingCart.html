<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <title>Portal Auto Center</title>
    <link rel="stylesheet" type="text/css" href="assets/css/pac_framework.css">
    <link rel="stylesheet" type="text/css" href="assets/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="assets/css/shoppingCart.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/api.js"></script>
    <script src="js/utils.js"></script>
  </head>
  <body>
    
    <!-- Page's header -->
    <nav class="nav-header white-txt">
      <!-- Arrow back icon -->
      <a id="menu" href="home.html">
        <div class="menu">
          <i class="material-icons block">arrow_back</i>
        </div>
      </a>
      <!-- Header title -->
      <div class="header-title">
        <span class="block">Meu Carrinho</span>
      </div>
    </nav>
    <!-- *********************** -->

    <!-- Blank space -->
    <div class="blank-space"></div>

    <!-- Main content -->
    <div id="main" class="main">

      <!-- Item -->
      <!-- Cart item cotainer -->
      <!-- <div class="cart-item"> -->

        <!-- Product's information container -->
        <!-- <div class="product-info"> -->

          <!-- Product's image -->
         <!--  <div class="product-img" style="  background-image: url(https://images.unsplash.com/photo-1441148345475-03a2e82f9719?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=fbf40a1199089ae74b75010d4ed14724&dpr=1&auto=format&fit=crop&w=1000&q=80&cs=tinysrgb);
            background-attachment: scroll;
            background-size: cover;"> -->
              
              <!-- Items count -->
              <!-- <div class="item-count">
                <p class="absolute white-txt">2</p>
              </div>

            </div> -->

          <!-- Information's data -->
          <!-- <div class="info-data"> -->
            
            <!-- Product's informations -->
            <!-- <div class="informations"> -->
              
              <!-- Product's name -->
              <!-- <div class="row bold">
                  <span class="block">Mercedez C180</span>
              </div>
 -->
              <!-- Product's category -->
              <!-- <div class="row">
                  <span class="block">Carros</span>
              </div> -->

              <!-- Product's price -->
              <!-- <div class="row">
                  <span class="block">R$ 748.415,00</span>
              </div>

            </div> -->

            <!-- Delete button container -->
            <!-- <div class="delete-container">
              <i class="material-icons" title="Remover item">clear</i>
            </div>

          </div>
          
        </div> -->

        <!-- Add and remove item button container -->
        <!-- <div class="add-remove-item"> -->
          <!-- Remove "button" -->
         <!--  <a href="#">
            <i class="material-icons white-txt">remove</i>
          </a> -->

          <!-- Add "button" -->
          <!-- <a href="#">
            <i class="material-icons white-txt">add</i>
          </a>
        </div>
        
      </div> -->

      <!-- Item -->
      <!-- Cart item cotainer -->
      <!-- <div class="cart-item"> -->

        <!-- Product's information container -->
        <!-- <div class="product-info"> -->

          <!-- Product's image -->
          <!-- <div class="product-img" style="  background-image: url(https://images.unsplash.com/photo-1513036191774-b2badb8fcb76?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=d235227c566eaf1b7f2af48bbbdde1da&dpr=1&auto=format&fit=crop&w=1000&q=80&cs=tinysrgb);
            background-attachment: scroll;
            background-size: cover;"> -->
              
              <!-- Items count -->
              <!-- <div class="item-count">
                <p class="absolute white-txt">4</p>
              </div>

            </div> -->

          <!-- Information's data -->
          <!-- <div class="info-data"> -->
            
            <!-- Product's informations -->
            <!-- <div class="informations"> -->
              
              <!-- Product's name -->
              <!-- <div class="row bold">
                  <span class="block">Roda Aro 17</span>
              </div> -->

              <!-- Product's category -->
              <!-- <div class="row">
                  <span class="block">Acessórios</span>
              </div> -->

              <!-- Product's price -->
              <!-- <div class="row">
                  <span class="block">R$ 421,39</span>
              </div>

            </div> -->

            <!-- Delete button container -->
           <!--  <div class="delete-container">
              <i class="material-icons" title="Remover item">clear</i>
            </div>

          </div>
          
        </div> -->

        <!-- Add and remove item button container -->
        <!-- <div class="add-remove-item"> -->
          <!-- Remove "button" -->
          <!-- <a href="#">
            <i class="material-icons white-txt">remove</i>
          </a> -->

          <!-- Add "button" -->
          <!-- <a href="#">
            <i class="material-icons white-txt">add</i>
          </a>
        </div>
        
      </div> -->

      <!-- Item -->
      <!-- Cart item cotainer -->
      <!-- <div class="cart-item"> -->

        <!-- Product's information container -->
        <!-- <div class="product-info"> -->

          <!-- Product's image -->
          <!-- <div class="product-img" style="  background-image: url(https://images.unsplash.com/photo-1464876008302-fda7c9655196?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=eedf75f78469f977b57126a22f251788&dpr=1&auto=format&fit=crop&w=1000&q=80&cs=tinysrgb);
            background-attachment: scroll;
            background-size: cover;"> -->
              
              <!-- Items count -->
              <!-- <div class="item-count">
                <p class="absolute white-txt">1</p>
              </div>

            </div> -->

          <!-- Information's data -->
          <!-- <div class="info-data"> -->
            
            <!-- Product's informations -->
            <!-- <div class="informations"> -->
              
              <!-- Product's name -->
             <!--  <div class="row bold">
                  <span class="block">Roda Aro 17</span>
              </div> -->

              <!-- Product's category -->
             <!--  <div class="row">
                  <span class="block">Acessórios</span>
              </div> -->

              <!-- Product's price -->
              <!-- <div class="row">
                  <span class="block">R$ 421,39</span>
              </div> -->

            <!-- </div> -->

            <!-- Delete button container -->
            <!-- <div class="delete-container">
              <i class="material-icons" title="Remover item">clear</i>
            </div>

          </div>
          
        </div> -->

        <!-- Add and remove item button container -->
        <!-- <div class="add-remove-item"> -->
          <!-- Remove "button" -->
          <!-- <a href="#">
            <i class="material-icons white-txt">remove</i>
          </a> -->

          <!-- Add "button" -->
          <!-- <a href="#">
            <i class="material-icons white-txt">add</i>
          </a>
        </div>
        
      </div> -->

    <!-- </div> -->
    <!-- *********************** -->

    <!-- Total pay container -->
    <div id="total-pay" class="total-pay">
      <span class="block white-txt">R$ </span>
    </div>

    <!-- Reset password button -->
    <a class="snackbar green-light uppercase" href="#">      
      Finalizar Compra
    </a>
    <!-- *********************** -->

    <!-- Models -->
    <script src="js/model/ShoppingCart.js"></script>
    <script src="js/model/Product.js"></script>
    <script src="js/model/OrderPayment.js"></script>
    <!-- DAOs -->
    <script src="js/dao/ProductDAO.js"></script>

    <script>

      // Get the shopping cart
      var shoppingCart = ShoppingCart.getShoppingCart();

      // console.log(ShoppingCart.getProductsId());

      if(shoppingCart.length > 0)
      { 

        // Create a list with Product objectes
        new Product().createProductList();  

        // console.log(ShoppingCart.getProductsId());
        for(var i = 0; i < ShoppingCart.getProductsId().length; i++)
        {

          var product = new Product();

          product.getProductBasicInfoById(
            ShoppingCart.getProductsId()[i], // product's id 
            function(product)
            {

              // Create a product object to insert it into products list
              var tempProduct = new Product(
                product.id_produto, 
                null, 
                product.id_parceiro, 
                null, 
                product.id_categoria_produto, 
                product.nome, 
                product.preco, 
                product.conteudo_embalagem, 
                product.garantia, 
                product.descricao, 
                product.observacao
              )

               // Add the product to products list
              tempProduct.addProductToList(tempProduct);

              console.log(product);
              $('#main').append
              (
                 `<!-- Item -->
                  <!-- Cart item cotainer -->
                  <div class="cart-item">

                    <!-- Product's information container -->
                    <div class="product-info">

                      <!-- Product's image -->
                      <div class="product-img" style="background-image: url(${picturePath['product']+getPictureName('produto',product.imagem)});
                        background-attachment: scroll;
                        background-size: cover;">
                          
                          <!-- Items count -->
                          <div class="item-count">
                            <p class="absolute white-txt">${ShoppingCart.getProductsCount(product.id_produto)}</p>
                          </div>

                        </div>

                      <!-- Information's data -->
                      <div class="info-data">
                        
                        <!-- Product's informations -->
                        <div class="informations">
                          
                          <!-- Product's name -->
                          <div class="row bold">
                              <span class="block">${product.nome}</span>
                          </div>

                          <!-- Product's category -->
                          <div class="row">
                              <span class="block">${product.categoria}</span>
                          </div>

                          <!-- Product's price -->
                          <div class="row">
                              <span class="block">R$ ${product.preco}</span>
                          </div>

                        </div>

                        <!-- Delete button container -->
                        <div data-id="${product.id_produto}" class="delete-container">
                          <i class="material-icons" title="Remover item">clear</i>
                        </div>

                      </div>
                      
                    </div>

                    <!-- Add and remove item button container -->
                    <div class="add-remove-item">
                      <!-- Remove "button" -->
                      <a href="#">
                        <i class="material-icons white-txt">remove</i>
                      </a>

                      <!-- Add "button" -->
                      <a href="#">
                        <i class="material-icons white-txt">add</i>
                      </a>
                    </div>
                    
                  </div>`
              );
            }
          );
        }
      }

      // Set total value existent into shopping cart
      $('#total-pay').find('span').append(ShoppingCart.getFullAmount());


      // Show total to pay
      setTimeout(function()
      {
        
        $('#total-pay').css({
          bottom:'40px',
          transition:'1s'
        });

      },
      1000);

      // Remove order from shopping cart when click on item
      $(document).on('click','.delete-container',function(){

        // Product's id
        var productId = $(this).data('id');
        
        if(ShoppingCart.removeOrder(productId))
        {
          location.reload();
        }

      });

      $('.snackbar').click(function(){

        // Create a order payment group
        OrderPayment.createOrderPaymentGroup();
        var shoppingCart = ShoppingCart.getShoppingCart();
        var productList = Product.getProductList();


        for (var i = 0; i <  shoppingCart.length; i++) 
        {
          var productIdFromSC = shoppingCart[i].order.productId;
          var product = null;

          for(var w = 0; w < productList.length; w++)
          {
            var productId = productList[w].product.idProduto;
            var prdFromList = productList[w].product;

            if (productIdFromSC == productId) 
            {
              product = new Product(
                prdFromList.idProduto, 
                null, 
                null, 
                null, 
                null, 
                prdFromList.nome, 
                prdFromList.preco
              );
            }
          }

          // Add OrderPayment to order payment group
          OrderPayment.addOrderPaymentToGroup(
            new OrderPayment(
              product.idProduto,
              product.nome,
              product.preco,
              1,
              true
            )
          );
        }



        // // Create a Order instance to make the order request
        // new Order(
        //   serviceId, 
        //   unitPrice, 
        //   new Client().getClientFromApp().id_cliente, 
        //   3,
        //   requestDate
        // );

        // // Redirect user to payment page
        // setTimeout(function(){
        //   location.assign('paymentData.html?prd=service');
        // },1000);

      });

    </script>

  </body>
</html>
